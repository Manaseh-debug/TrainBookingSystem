<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Booking</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function calculateCost() {
            const fares = {
                "Nairobi-Nakuru": 800, "Nairobi-Kericho": 1200, "Nairobi-Kisumu": 1500, "Nairobi-Kakamega": 1800,
                "Nakuru-Kericho": 600, "Nakuru-Kisumu": 1000, "Nakuru-Kakamega": 1400,
                "Kericho-Kisumu": 500, "Kericho-Kakamega": 900,
                "Kisumu-Kakamega": 400
            };
            let origin = document.getElementById("origin").value;
            let dest = document.getElementById("destination").value;
            let passengers = parseInt(document.getElementById("passengers").value);
            if (origin === dest) { document.getElementById("totalCost").innerText = "KES 0"; return; }
            let key = origin + "-" + dest;
            if (!(key in fares)) key = dest + "-" + origin;
            let cost = fares[key] * passengers;
            document.getElementById("totalCost").innerText = "KES " + cost;
        }
    </script>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
        <a class="navbar-brand" href="/booking">Train Booking</a>
        <div class="navbar-nav ms-auto">
            <span class="navbar-text text-white me-3">Welcome, User!</span>
            <a class="btn btn-outline-light btn-sm" href="/logout">Logout</a>
        </div>
    </div>
</nav>
<div class="container mt-5">
    <div th:if="${bookingID != null and paymentDue != null}">
        <div class="alert alert-info">
            <h4 class="alert-heading">Booking Created Successfully!</h4>
            <p>Booking ID: <strong>${bookingID}</strong></p>
            <p>Amount Due: <strong>KES ${paymentDue}</strong></p>
            <hr>
            <form method="post" action="/pay">
                <input type="hidden" name="bookingID" value="${bookingID}">
                <input type="hidden" name="userID" value="${userID}">
                <h5 class="mb-3">Enter Payment Details</h5>
                <div class="mb-3">
                    <label>Card Number</label>
                    <input type="text" class="form-control" placeholder="1234-5678-9012-3456" required>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Expiry Date</label>
                        <input type="text" class="form-control" placeholder="MM/YY" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>CVV</label>
                        <input type="text" class="form-control" placeholder="123" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success w-100">Pay Now - KES ${paymentDue}</button>
            </form>
        </div>
    </div>

    <div th:if="${message}">
        <div class="alert ${message.contains('success') ? 'alert-success' : 'alert-warning'}">
            ${message}
        </div>
    </div>

    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Book Your Train</h4>
        </div>
        <div class="card-body">
            <form method="post" action="/book">
                <input type="hidden" name="userID" value="${userID}">
                <div class="mb-3">
                    <label class="form-label">Origin</label>
                    <select id="origin" name="origin" class="form-select" onchange="calculateCost()">
                        <option>Nairobi</option><option>Nakuru</option><option>Kericho</option>
                        <option>Kisumu</option><option>Kakamega</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Destination</label>
                    <select id="destination" name="destination" class="form-select" onchange="calculateCost()">
                        <option>Nairobi</option><option>Nakuru</option><option>Kericho</option>
                        <option>Kisumu</option><option>Kakamega</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Number of Passengers</label>
                    <input type="number" id="passengers" name="passengers" value="1" min="1" max="10" class="form-control" onchange="calculateCost()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Departure Date</label>
                    <input type="date" name="date" class="form-control" required>
                </div>
                <div class="mb-3 p-3 bg-light rounded">
                    <label class="form-label fw-bold">Estimated Total Cost:</label>
                    <div id="totalCost" class="display-6 text-primary">KES 0</div>
                </div>
                <button type="submit" class="btn btn-primary w-100 btn-lg">Create Booking</button>
            </form>
        </div>
    </div>
</div>
</body>
</html>
